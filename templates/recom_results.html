{% extends "base.html" %}
{% block head %}
    <title>Your recommendations</title>
{% endblock %}

{% block navbar %}
    <li class="nav-item">
        <a class="nav-link js-scroll-trigger" href="#info">Notes</a>
    </li>
    <li>
        <a class="nav-link js-scroll-trigger" href="#recoms">Your recommendations</a>
    </li>
{% endblock %}

{% block body %}
<header class="bg-primary text-white">
      <div class="container text-center">
        <h1>Your recommendations are here!</h1>
        <p class="lead">We have generated several sets of recommendations for you,
            and now we would like to ask you to provide us with feedback on them.</p>
      </div>
</header>

<section id="info">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                Now that we've generated recommendations for you, we'll be asking you {{ pairwise_comparison_count }} questions,
                in each of which we present two lists of articles that we recommend to you. Each list is a collection of various articles that we believe
                you might like, and is not necessarily a topically coherent set.
                The feedback we would like to ask you to give us, is to compare each pair of lists,
                and tell us which list in the pair contains more articles that you would be interested in editing or in reading.<br>
                Once you have answered all the questions, press the submit button to send us your feedback. Thank you for
                helping us make Wikipedia more welcoming!
            </div>
        </div>
    </div>
</section>

<section id="recoms">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 mx-auto">

                    <form name="feedback" action = "/thankyou" method = "POST" onsubmit="submission_check_feedback();">
                        {% for comparison_number in range(pairwise_comparison_count) %}
                            {# We get the dictionary of articles for this recommendation (the 4-tuple or 3-tuple) #}
                            {% set current_pair_indices = comparison_pairs[comparison_number] %}
                            {% set recom_list_A = recoms_dict[current_pair_indices[0]] %}
                            {% set recom_list_B = recoms_dict[current_pair_indices[1]] %}
                            <div id="group{{ comparison_number }}" class="frmdiv">
                                <fieldset>
                                    <b>Comparison #{{ comparison_number + 1 }}: Please look at the two lists of recommendations below, and answer the questions that follow:</b>
                                        <div class="row">
                                            <div class="col left mx-auto">
                                                <b>Recommendation list A:</b> <br>
                                                <ul>
                                                {% for x in recom_list_A %}
                                                    <li><a href="https://en.wikipedia.org/wiki/{{ x }}" target="_blank">{{ x }}</a> </li>
                                                {% endfor %}
                                                </ul>
                                            </div>
                                            <div class="col right mx-auto">
                                                <b>Recommendation list B:</b> <br>
                                                <ul>
                                                {% for x in recom_list_B %}
                                                    <li><a href="https://en.wikipedia.org/wiki/{{ x }}" target="_blank">{{ x }}</a></li>
                                                {% endfor %}
                                                </ul>
                                            </div>
                                        </div>

                                        <div class="mx-auto">
                                            <h4>Which one of these lists contains more articles that you would be interested in <b>reading</b>?</h4>
                                                <input type="radio" id="read{{ comparison_number }}1" value="2" name="read_group{{ comparison_number }}">
                                                <label for="read{{ comparison_number }}1">List A, by a wide margin.</label><br>
                                                
                                                <input type="radio" id="read{{ comparison_number }}2" value="1" name="read_group{{ comparison_number }}">
                                                <label for="read{{ comparison_number }}2">List A, by a narrow margin.</label><br>
                                                
                                                <input type="radio" id="read{{ comparison_number }}3" value="0" name="read_group{{ comparison_number }}">
                                                <label for="read{{ comparison_number }}3">They are equal for me.</label><br>
                                                
                                                <input type="radio" id="read{{ comparison_number }}4" value="-1" name="read_group{{ comparison_number }}">
                                                <label for="read{{ comparison_number }}4">List B, by a narrow margin.</label><br>
                                                
                                                <input type="radio" id="read{{ comparison_number }}5" value="-2" name="read_group{{ comparison_number }}">
                                                <label for="read{{ comparison_number }}5">List B, by a wide margin.</label><br>
                                        </div>
                                        
                                        <div class="mx-auto">
                                            <h4>Which one of these lists contains more articles that you would be interested in <b>editing</b>?</h4>
                                                <input type="radio" id="edit{{ comparison_number }}1" value="2" name="edit_group{{ comparison_number }}">
                                                <label for="edit{{ comparison_number }}1">List A, by a wide margin.</label><br>
                                                
                                                <input type="radio" id="edit{{ comparison_number }}2" value="1" name="edit_group{{ comparison_number }}">
                                                <label for="edit{{ comparison_number }}2">List A, by a narrow margin.</label><br>
                                                
                                                <input type="radio" id="edit{{ comparison_number }}3" value="0" name="edit_group{{ comparison_number }}">
                                                <label for="edit{{ comparison_number }}3">They are equal for me.</label><br>
                                                
                                                <input type="radio" id="edit{{ comparison_number }}4" value="-1" name="edit_group{{ comparison_number }}">
                                                <label for="edit{{ comparison_number }}4">List B, by a narrow margin.</label><br>
                                                
                                                <input type="radio" id="edit{{ comparison_number }}5" value="-2" name="edit_group{{ comparison_number }}">
                                                <label for="edit{{ comparison_number }}5">List B, by a wide margin.</label><br>
                                        </div>

                                        <div class="mx-auto">
                                            <h4>Which one of these lists contains more articles that you are <b>not</b> interested in at all, neither for reading nor for editing?</h4>
                                                <input type="radio" id="uninterested{{ comparison_number }}1" value="2" name="uninterested_group{{ comparison_number }}">
                                                <label for="uninterested{{ comparison_number }}1">List A, by a wide margin.</label><br>

                                                <input type="radio" id="uninterested{{ comparison_number }}2" value="1" name="uninterested_group{{ comparison_number }}">
                                                <label for="uninterested{{ comparison_number }}2">List A, by a narrow margin.</label><br>

                                                <input type="radio" id="uninterested{{ comparison_number }}3" value="0" name="uninterested_group{{ comparison_number }}">
                                                <label for="uninterested{{ comparison_number }}3">They are equal for me.</label><br>

                                                <input type="radio" id="uninterested{{ comparison_number }}4" value="-1" name="uninterested_group{{ comparison_number }}">
                                                <label for="uninterested{{ comparison_number }}4">List B, by a narrow margin.</label><br>

                                                <input type="radio" id="uninterested{{ comparison_number }}5" value="-2" name="uninterested_group{{ comparison_number }}">
                                                <label for="uninterested{{ comparison_number }}5">List B, by a wide margin.</label><br>
                                        </div>

                                        <div class="form-group">
                                            <div class="col-lg-10 col-lg-offset-3">

                                                {% if comparison_number != 0 %}
                                                    <button class="btn btn-dark" id="tofirst{{ comparison_number }}" type="button"><span class="fa fa-arrow-left"></span> To first</button>
                                                    <button class="btn btn-warning" id="back{{ comparison_number }}" type="button"><span class="fa fa-arrow-left"></span> Back</button>
                                                {% endif %}

                                                {% if comparison_number != pairwise_comparison_count - 1 %}
                                                    <button class="btn btn-primary" id="next{{ comparison_number }}" type="button">Next <span class="fa fa-arrow-right"></span></button>
                                                    <button class="btn btn-dark" id="tolast{{ comparison_number }}" type="button"><span class="fa fa-arrow-left"></span> To last</button>
                                                {% else %}
                                                    <input class="btn btn-primary" id="next{{ comparison_number }}" type = "submit" value = "Submit"/>
                                                {% endif %}
                                            </div>
                                        </div>

                                </fieldset>
                            </div>
                        {% endfor %}

                      </form>



            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script type="text/javascript">
    $(document).ready(function() {
        $(".frmdiv").hide();
        $("#group0").show();
        {% for key in range(pairwise_comparison_count) %}
            {%if  key != 0 %}
                $("#back{{ key }}").click(function() {
                    $(".frmdiv").hide("fast");
                    $("#group{{ key - 1 }}").show("fast");
                    $(document).scrollTop( $("#recoms").offset().top );
                });
                $("#tofirst{{ key }}").click(function () {
                    $(".frmdiv").hide("fast");
                    $("#group0").show("fast");
                    $(document).scrollTop( $("#recoms").offset().top );
                });
            {% endif %}
            {% if key != pairwise_comparison_count - 1 %}
                $("#next{{ key }}").click(function() {
                    $(".frmdiv").hide("fast");
                    $("#group{{ key + 1 }}").show("fast");
                    $(document).scrollTop( $("#recoms").offset().top );
                });
                $("#tolast{{ key }}").click(function () {
                    $(".frmdiv").hide("fast");
                    $("#group{{ pairwise_comparison_count - 1 }}").show("fast");
                    $(document).scrollTop( $("#recoms").offset().top );
                });
            {% endif %}
        {% endfor %}

    });

    function submission_check_feedback() {
        if (!is_radio_group_complete('read_group', {{ pairwise_comparison_count }}) ||
            !is_radio_group_complete('edit_group', {{ pairwise_comparison_count }}) ||
            !is_radio_group_complete('uninterested_group', {{ pairwise_comparison_count }}))
        {
            event.preventDefault();
        }
    }

</script>
{% endblock %}