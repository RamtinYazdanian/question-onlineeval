{% extends "base.html" %}
{% block head %}
    <title>Your recommendations</title>
{% endblock %}

{% block navbar %}
    <li class="nav-item">
        <a class="nav-link js-scroll-trigger" href="#info">Notes</a>
    </li>
    <li>
        <a class="nav-link js-scroll-trigger" href="#recoms">Your recommendations</a>
    </li>
{% endblock %}

{% block body %}
<header class="bg-primary text-white">
      <div class="container text-center">
        <h1>Your recommendations are here!</h1>
        <p class="lead">Please rate them from 1 to 5 (very bad to very good).</p>
      </div>
</header>

<section id="info">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                A few tips: <br>
                <ul>
                    <li>The document are shown below their names so you can take a peek.</li>
                    <li>For each document, we have also listed some of their most frequent editors. If you are interested
                    in editing the article, you could try getting in touch with these veterans and forming groups.</li>
                    <li>Once you've rated them all, please press the submit button.</li>
                </ul>
            </div>
        </div>
    </div>
</section>

<section id="recoms">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 mx-auto">

                    <form name="feedback" action = "/thankyou" method = "POST">
                        {% for recom_number in range(recom_count) %}
                            {# We get the dictionary of articles for this recommendation (the 4-tuple or 3-tuple) #}
                            {% set current_recom_list = recoms_dict[recom_number] %}
                            <div id="group_{{ recom_number }}" class="frmdiv">
                                <fieldset>
                                    <b>Recommendation #{{ recom_number + 1 }}</b>
                                        {# Now we go through the indices of articles in this dictionary #}
                                        <div class="row">
                                            {% for article_index in range(type_count) %}
                                                {# We finally take the current article #}
                                                {% set current_article = current_recom_list[article_index] %}
                                                <div class="col">
                                                <h5 id="recom_{{ recom_number }}_{{ article_index }}">Document name: {{ recom_fields['name'] }}</h5>
{#                                                    <iframe src="https://en.wikipedia.org/w/index.php?search={{ recom_fields['name'] }}&title=Special%3ASearch&go=Go" width="100%", height="300"></iframe>#}
                                                </div>
                                            {% endfor %}
                                        </div>
                                        <div class="mx-auto">
                                        <h4>Which one of these documents would you be more interested in editing?</h4>
                                        {% for article_index in range(type_count) %}
                                            {% set current_article = current_recom_list[article_index] %}
                                            <input type="radio" id="editint_{{ recom_number }}_{{ article_index }}" value="{{ article_index }}" name="edit_interest_{{ recom_number }}"><label for="editint_{{ recom_number }}_{{ article_index }}">{{ current_article }}</label>
                                        {% endfor %}
                                        </div>

                                        <div class="form-group">
                                            <div class="col-lg-10 col-lg-offset-3">

                                                {% if recom_number != 0 %}
                                                    <button class="btn btn-dark" id="tofirst{{ recom_number }}" type="button"><span class="fa fa-arrow-left"></span> To first</button>
                                                    <button class="btn btn-warning" id="back{{ recom_number }}" type="button"><span class="fa fa-arrow-left"></span> Back</button>
                                                {% endif %}

                                                {% if recom_number != recommendations|length - 1 %}
                                                    <button class="btn btn-primary" id="next{{ recom_number }}" type="button">Next <span class="fa fa-arrow-right"></span></button>
                                                    <button class="btn btn-dark" id="tolast{{ recom_number }}" type="button"><span class="fa fa-arrow-left"></span> To last</button>
                                                {% else %}
                                                    <input class="btn btn-primary" id="next{{ recom_number }}" type = "submit" value = "Submit"/>
                                                {% endif %}
                                            </div>
                                        </div>

                                </fieldset>
                            </div>
                        {% endfor %}

                      </form>



            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script type="text/javascript">
    $(document).ready(function() {
        $(".frmdiv").hide();
        $("#group0").show();
        {% for key in recommendations %}
            {%if  key != 0 %}
                $("#back{{ key }}").click(function() {
                    $(".frmdiv").hide("fast");
                    $("#group{{ key - 1 }}").show("fast");
                    $(document).scrollTop( $("#recoms").offset().top );
                });
                $("#tofirst{{ key }}").click(function () {
                    $(".frmdiv").hide("fast");
                    $("#group0").show("fast");
                    $(document).scrollTop( $("#recoms").offset().top );
                });
            {% endif %}
            {% if key != recommendations|length - 1 %}
                $("#next{{ key }}").click(function() {
                    $(".frmdiv").hide("fast");
                    $("#group{{ key + 1 }}").show("fast");
                    $(document).scrollTop( $("#recoms").offset().top );
                });
                $("#tolast{{ key }}").click(function () {
                    $(".frmdiv").hide("fast");
                    $("#group{{ recommendations|length - 1 }}").show("fast");
                    $(document).scrollTop( $("#recoms").offset().top );
                });
            {% endif %}
        {% endfor %}

    });

</script>
{% endblock %}