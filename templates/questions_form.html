{% extends "base.html" %}
{% block head %}
    <title>Wikipedia Questionnaire</title>

{% endblock %}

{% block navbar %}
    <li class="nav-item">
        <a class="nav-link js-scroll-trigger" href="#howto">How To</a>
    </li>
    <li>
        <a class="nav-link js-scroll-trigger" href="#questions">Questions</a>
    </li>
{% endblock %}

{% block body %}

    <header class="bg-primary text-white">
      <div class="container text-center">
        <h1>Welcome to the Wikipedia entry questionnaire!</h1>
        <p class="lead">A questionnaire aiming to learn about your interests in Wikipedia.</p>
      </div>
    </header>

    <section id="howto">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    This questionnaire contains {{ n_q }} questions, which attempt to capture your topics of interest,
                    based on which we will provide you with article recommendations. A few important points on the questionnaire:<br>
                    <ul>
                        <li>Please have cookies enabled. If you do not have them enabled, please enable them
                        and refresh this page.</li>
                        <li>Each question asks you about the set you prefer among two sets of articles (set A and set B) and how great your preference is.
                        There are 7 answers possible, ranging from "A, greatly" to "Indifferent" to "B, greatly". Only a single answer is possible for each question.</li>
                        <li>When stating your preference between a pair of article sets, bear in mind that if you state a great preference for a set,
                        you are much more likely to see articles like those in that set in your recommendations. Therefore, use the "greatly prefer" options
                        to indicate your absolute favourite topics and do not use them simply because you dislike the other set.</li>
                        <li>Please answer all {{ n_q }} questions. Because we're evaluating our system
                        based on this, we need full information on how users interact with each question. The
                        form cannot be submitted without having chosen an answer for each question.</li>
                        <li>Once you have answered all the questions, we kindly ask you to also enter your username. Your data will only be used
                        for the purposes of this research project, and it will remain confidential and will not be disclosed to anyone.</li>
                        <li>Once you have submitted the questionnaire, we record your answers and generate several sets
                        of recommendations for you, which we will then ask you to compare and rate.
                        The generation of those recommendations might take a few seconds, so we thank you
                        in advance for your patience while the recommendations are being computed.</li>
                        <li>We would like to remind you that the privacy statement for this study may be found
                            <a href="https://foundation.wikimedia.org/wiki/Elicit_New_Editor_Interests_Survey_Privacy_Statement">here</a>.</li>
                        <li>This page is best viewed on non-mobile platforms.</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <section id="questions">
      <div class="container">
        <div class="row">
          <div class="col-10 mx-auto">
                    <form name="questionnaire" action = "/result" method = "POST" onsubmit="submission_check_survey();">
                        {% for key in range(n_q) %}

                            <div id="group{{ key }}" class="frmdiv">
                            <fieldset>

                                {% set question_value = questions[key|string] %}


                                <h2 id="q{{ key }}">Question {{ key + 1 }}: Review the two sets of articles A and B, and answer the following question:
                                    Which set of articles would you prefer for <b>editing</b>, and how much? Choose "Indifferent" if neither of these sets interests you.</h2>
                                <div class="row">
                                    <div class="col left mx-auto">
                                        <b>Set A:</b> <br>
                                        <ul>
                                        {% for x in question_value['top'] %}
                                            <li><a href="https://en.wikipedia.org/wiki/{{ x }}" target="_blank">{{ x }}</a> </li>
                                        {% endfor %}
                                        </ul>
                                    </div>
                                    <div class="col right mx-auto">
                                        <b>Set B:</b> <br>
                                        <ul>
                                        {% for x in question_value['bottom'] %}
                                            <li><a href="https://en.wikipedia.org/wiki/{{ x }}" target="_blank">{{ x }}</a></li>
                                        {% endfor %}
                                        </ul>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col left mx-auto">
                                        <b>Most important words:</b> <br><br>
                                        <img src="{{ cloud_dir }}{{ key }}_top.png">
                                    </div>

                                    <div class="col right mx-auto">
                                        <b>Most important words:</b> <br><br>
                                        <img src="{{ cloud_dir }}{{ key }}_bottom.png">
                                    </div>
                                </div>

                                <h4>Your answer:</h4>
                                <div class="row">
                                        <div class="mr-5"><input type="radio" id="r{{ key }}1" value="3" name="q_group_{{ key }}"><br><label for="r{{ key }}1">A, greatly</label></div>
                                        <div class="mr-5"><input type="radio" id="r{{ key }}2" value="2" name="q_group_{{ key }}"><br><label for="r{{ key }}2">A, moderately</label></div>
                                        <div class="mr-5"><input type="radio" id="r{{ key }}3" value="1" name="q_group_{{ key }}"><br><label for="r{{ key }}3">A, slightly</label></div>
                                        <div class="mr-5"><input type="radio" id="r{{ key }}4" value="0" name="q_group_{{ key }}"><br><label for="r{{ key }}4">Indifferent</label></div>
                                        <div class="mr-5"><input type="radio" id="r{{ key }}5" value="-1" name="q_group_{{ key }}"><br><label for="r{{ key }}5">B, slightly</label></div>
                                        <div class="mr-5"><input type="radio" id="r{{ key }}6" value="-2" name="q_group_{{ key }}"><br><label for="r{{ key }}6">B, moderately</label></div>
                                        <div class="mr-5"><input type="radio" id="r{{ key }}7" value="-3" name="q_group_{{ key }}"><br><label for="r{{ key }}7">B, greatly</label></div>

                                </div>
                                {% if key == n_q - 1 %}
                                    <div class="mx-auto">
                                        <h4 style="color: orangered">Before you submit the questionnaire...</h4>
                                        <input class="form-text" type="text" name="name_field" id="name_field" placeholder="Please enter your Wikipedia username here."/>
                                    </div><br>
                                {% endif %}
                                <div class="form-group">
                                    <div class="col-lg-10 col-lg-offset-3">

                                        {% if key != 0 %}
                                            <button class="btn btn-dark" id="tofirst{{ key }}" type="button"><span class="fa fa-arrow-left"></span> To first</button>
                                            <button class="btn btn-warning" id="back{{ key }}" type="button"><span class="fa fa-arrow-left"></span> Back</button>
                                        {% endif %}

                                        {% if key != n_q - 1 %}
                                            <button class="btn btn-primary" id="next{{ key }}" type="button">Next <span class="fa fa-arrow-right"></span></button>
                                            <button class="btn btn-dark" id="tolast{{ key }}" type="button"><span class="fa fa-arrow-left"></span> To last</button>
                                        {% else %}
                                            <input class="btn btn-primary" id="next{{ key }}" type = "submit" value = "Submit"/>
                                        {% endif %}
                                    </div>
                                </div>

                            </fieldset>
                            </div>


                        {% endfor %}


                      </form>

            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block scripts %}
<script type="text/javascript">
    $(document).ready(function() {
        $(".frmdiv").hide();
        $("#group0").show();
        {% for key in range(n_q) %}
            {%if  key != 0 %}
                $("#back{{ key }}").click(function() {
                    $(".frmdiv").hide("fast");
                    $("#group{{ key - 1 }}").show("fast");
                    $(document).scrollTop( $("#questions").offset().top );
                });
                $("#tofirst{{ key }}").click(function () {
                    $(".frmdiv").hide("fast");
                    $("#group0").show("fast");
                    $(document).scrollTop( $("#questions").offset().top );
                });
            {% endif %}
            {% if key != n_q - 1 %}
                $("#next{{ key }}").click(function() {
                    $(".frmdiv").hide("fast");
                    $("#group{{ key + 1 }}").show("fast");
                    $(document).scrollTop( $("#questions").offset().top );
                });
                $("#tolast{{ key }}").click(function () {
                    $(".frmdiv").hide("fast");
                    $("#group{{ n_q - 1 }}").show("fast");
                    $(document).scrollTop( $("#questions").offset().top );
                });
            {% endif %}
        {% endfor %}

    });

    $("input[placeholder]").each(function () {
        $(this).attr('size', $(this).attr('placeholder').length);
    });

    function submission_check_survey() {
        if (!is_radio_group_complete('q_group_', {{ n_q }}) || !name_entered())
        {
            event.preventDefault();
        }
    }

</script>
{% endblock %}